<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Calculadora de Inter√©s Compuesto de Novusance Finance. Planifica tu inversi√≥n y descubre el poder del inter√©s compuesto.">
    <meta name="keywords" content="calculadora inter√©s compuesto, inversi√≥n, finanzas, ahorro, rentabilidad">
    
    <!-- Google AdSense - Reemplaza con tu c√≥digo cuando te aprueben -->
    <!-- PASO 1: Descomenta esta l√≠nea y a√±ade tu ID de publisher cuando AdSense te apruebe
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXXXXXXXXXXXXXX"
     crossorigin="anonymous"></script>
    -->
    
    <!-- jsPDF para generar PDF en el navegador -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    
    <title>Novusance Finance - Calculadora de Inter√©s Compuesto</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #e8f5f3 0%, #d4f1f4 50%, #c8e6e8 100%);
            min-height: 100vh;
            padding: 0;
            margin: 0;
            position: relative;
        }

        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 30%, rgba(26, 188, 156, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(22, 160, 133, 0.08) 0%, transparent 50%);
            pointer-events: none;
        }

        .container {
            position: relative;
            z-index: 1;
        }

        .content-wrapper {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            width: 100%;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 3px solid #1abc9c;
            box-shadow: 0 4px 20px rgba(26, 188, 156, 0.15);
            padding: 0;
            margin: 0;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 30px 40px;
            color: #2c3e50;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo {
            width: 60px;
            height: 60px;
            object-fit: contain;
        }

        .header-text h1 {
            font-size: 2.5em;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            text-align: left;
        }

        .header-text p {
            font-size: 1em;
            opacity: 0.9;
            text-align: left;
            margin: 0;
        }

        .language-selector {
            display: flex;
            gap: 10px;
            background: rgba(26, 188, 156, 0.1);
            padding: 10px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .language-btn {
            padding: 8px 16px;
            background: transparent;
            color: #2c3e50;
            border: 2px solid rgba(26, 188, 156, 0.4);
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .language-btn:hover {
            border-color: #1abc9c;
            background: rgba(26, 188, 156, 0.2);
        }

        .language-btn.active {
            background: #1abc9c;
            border-color: #1abc9c;
            color: white;
        }

        .hero-section {
            padding: 100px 40px;
            text-align: center;
            background: linear-gradient(135deg, rgba(26, 188, 156, 0.05) 0%, rgba(22, 160, 133, 0.05) 100%);
        }

        .hero-content {
            max-width: 800px;
            margin: 0 auto;
        }

        .hero-content h2 {
            font-size: 3em;
            color: #2c3e50;
            margin-bottom: 20px;
            line-height: 1.2;
        }

        .hero-content .highlight-text {
            color: #1abc9c;
            font-weight: bold;
        }

        .hero-content p {
            font-size: 1.3em;
            color: #555;
            margin-bottom: 40px;
            line-height: 1.6;
        }

        .cta-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 40px;
        }

        .cta-button {
            display: inline-block;
            padding: 20px 50px;
            background: linear-gradient(135deg, #1abc9c 0%, #16a085 100%);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 8px 25px rgba(26, 188, 156, 0.3);
            text-decoration: none;
        }

        .cta-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(26, 188, 156, 0.4);
        }

        .cta-button-outline {
            display: inline-block;
            padding: 20px 50px;
            background: transparent;
            color: #1abc9c;
            border: 2px solid #1abc9c;
            border-radius: 50px;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
        }

        .cta-button-outline:hover {
            background: #1abc9c;
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(26, 188, 156, 0.3);
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 30px;
            margin-top: 60px;
            max-width: 1000px;
            margin-left: auto;
            margin-right: auto;
        }

        .feature-item {
            text-align: center;
            padding: 20px;
        }

        .feature-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 15px;
            object-fit: contain;
        }

        .feature-item h3 {
            color: #2c3e50;
            font-size: 1.3em;
            margin-bottom: 10px;
        }

        .feature-item p {
            color: #666;
            font-size: 1em;
            line-height: 1.5;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .card h2 {
            color: #1abc9c;
            margin-bottom: 25px;
            font-size: 1.8em;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        .input-group input,
        .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: #1abc9c;
        }

        .calculate-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #1abc9c 0%, #16a085 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-bottom: 10px;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(26, 188, 156, 0.4);
        }

        .reset-btn {
            width: 100%;
            padding: 15px;
            background: white;
            color: #1abc9c;
            border: 2px solid #1abc9c;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .download-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #2c3e50 0%, #3d5166 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(44, 62, 80, 0.3);
        }

        .download-btn:active {
            transform: translateY(0);
        }

        .results {
            margin-top: 30px;
        }

        .result-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #1abc9c;
        }

        .result-item .label {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .result-item .value {
            color: #333;
            font-size: 1.5em;
            font-weight: bold;
        }

        .highlight {
            background: linear-gradient(135deg, #1abc9c 0%, #16a085 100%);
            color: white;
            border-left: none;
        }

        .highlight .label {
            color: rgba(255,255,255,0.9);
        }

        .highlight .value {
            color: white;
        }

        .yearly-table-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .yearly-table-section h3 {
            color: #1abc9c;
            font-size: 1.5em;
            margin-bottom: 20px;
        }

        .table-wrapper {
            overflow-x: auto;
            border-radius: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95em;
        }

        thead tr {
            background: linear-gradient(135deg, #1abc9c 0%, #16a085 100%);
            color: white;
        }

        thead th {
            padding: 14px 16px;
            text-align: right;
            font-weight: 600;
            letter-spacing: 0.3px;
        }

        thead th:first-child {
            text-align: center;
            border-radius: 10px 0 0 0;
        }

        thead th:last-child {
            border-radius: 0 10px 0 0;
        }

        tbody tr {
            border-bottom: 1px solid #f0f0f0;
            transition: background 0.2s;
        }

        tbody tr:hover {
            background: rgba(26, 188, 156, 0.06);
        }

        tbody tr:last-child {
            border-bottom: none;
            font-weight: 700;
            background: rgba(26, 188, 156, 0.08);
        }

        tbody td {
            padding: 12px 16px;
            text-align: right;
            color: #333;
        }

        tbody td:first-child {
            text-align: center;
            font-weight: 700;
            color: #1abc9c;
        }

        .gains-cell {
            color: #16a085 !important;
            font-weight: 600 !important;
        }

        .gains-positive::before {
            content: '+';
        }

        .info-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            margin-top: 30px;
        }

        .info-section h3 {
            color: #1abc9c;
            margin-bottom: 15px;
        }

        .info-section p {
            color: #666;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        footer {
            background: rgba(255, 255, 255, 0.95);
            border-top: 3px solid #1abc9c;
            box-shadow: 0 -4px 20px rgba(26, 188, 156, 0.1);
            padding: 40px;
            margin-top: 40px;
        }

        .footer-content {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-bottom: 30px;
        }

        .footer-disclaimer h4,
        .footer-legal h4 {
            color: #1abc9c;
            font-size: 1em;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .footer-disclaimer p,
        .footer-legal p {
            color: #777;
            font-size: 0.85em;
            line-height: 1.6;
        }

        .footer-legal a {
            color: #1abc9c;
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
        }

        .footer-legal a:hover {
            text-decoration: underline;
        }

        .footer-bottom {
            text-align: center;
            color: #999;
            font-size: 0.85em;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
        }

        /* Modal Aviso Legal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal h3 {
            color: #1abc9c;
            font-size: 1.5em;
            margin-bottom: 20px;
        }

        .modal h4 {
            color: #2c3e50;
            margin: 20px 0 8px;
            font-size: 1em;
        }

        .modal p {
            color: #666;
            font-size: 0.9em;
            line-height: 1.7;
            margin-bottom: 10px;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #999;
            transition: color 0.3s;
        }

        .modal-close:hover {
            color: #1abc9c;
        }

        @media (max-width: 768px) {
            .footer-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            footer {
                padding: 30px 20px;
            }
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .header-content {
                flex-direction: column;
                gap: 20px;
                padding: 20px;
            }

            .header-left {
                flex-direction: column;
                text-align: center;
            }

            .logo {
                width: 50px;
                height: 50px;
            }

            .header-text h1 {
                font-size: 1.8em;
                text-align: center;
            }

            .header-text p {
                font-size: 0.9em;
                text-align: center;
            }

            .language-selector {
                width: 100%;
                justify-content: center;
            }

            .hero-section {
                padding: 60px 20px;
            }

            .hero-content h2 {
                font-size: 2em;
            }

            .hero-content p {
                font-size: 1.1em;
            }

            .features-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .cta-button, .cta-button-outline {
                padding: 15px 35px;
                font-size: 1em;
            }
        }

        .chart-container {
            margin-top: 20px;
            height: 350px;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px 20px 40px 20px;
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            gap: 8px;
        }

        .bar-group {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            position: relative;
        }

        .bar-stack {
            width: 100%;
            display: flex;
            flex-direction: column-reverse;
            border-radius: 4px 4px 0 0;
            overflow: hidden;
        }

        .bar {
            width: 100%;
            transition: all 0.4s ease;
            position: relative;
        }

        .bar.invested {
            background: linear-gradient(to top, #95a5a6, #bdc3c7);
        }

        .bar.gains {
            background: linear-gradient(to top, #1abc9c, #16a085);
        }

        .bar:hover {
            opacity: 0.85;
        }

        .bar-group-label {
            position: absolute;
            bottom: -28px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.75em;
            color: #666;
            white-space: nowrap;
            font-weight: 600;
        }

        .chart-legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #dee2e6;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
            color: #666;
        }

        .legend-color {
            width: 20px;
            height: 12px;
            border-radius: 3px;
        }

        .legend-color.invested {
            background: linear-gradient(to right, #95a5a6, #bdc3c7);
        }

        .legend-color.gains {
            background: linear-gradient(to right, #1abc9c, #16a085);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="header-left">
                    <img src="public/Novusance-Logo.png" alt="Novusance Finance Logo" class="logo">
                    <div class="header-text">
                        <h1>Novusance Finance</h1>
                        <p id="headerSubtitle">Planifica tu nueva era financiera</p>
                    </div>
                </div>
                <div class="language-selector">
                    <button class="language-btn active" onclick="changeLanguage('es')" id="btnEs">ES</button>
                    <button class="language-btn" onclick="changeLanguage('en')" id="btnEn">EN</button>
                </div>
            </div>
        </header>

        <!-- Hero Section -->
        <section class="hero-section">
            <div class="hero-content">
                <h2 id="heroTitle">Haz crecer tu <span class="highlight-text">patrimonio</span> con el poder del inter√©s compuesto</h2>
                <p id="heroDescription">
                    Descubre c√≥mo peque√±as inversiones hoy pueden transformarse en grandes ahorros ma√±ana. 
                    Con nuestra calculadora, visualiza el potencial de tus inversiones y toma el control de tu futuro financiero.
                </p>
                <div class="cta-buttons">
                    <a href="#calculator" class="cta-button" id="ctaButton">Calcula tu inversi√≥n ahora</a>
                    <a href="comparador.html" class="cta-button-outline" id="ctaComparator">Comparar escenarios</a>
                </div>

                <div class="features-grid">
                    <div class="feature-item">
                        <img src="public/grafico-de-crecimiento.png" alt="Crecimiento" class="feature-icon">
                        <h3 id="feature1Title">Crecimiento Exponencial</h3>
                        <p id="feature1Desc">El inter√©s compuesto multiplica tu dinero de forma exponencial con el tiempo</p>
                    </div>
                    <div class="feature-item">
                        <img src="public/invesment.png" alt="Inversi√≥n" class="feature-icon">
                        <h3 id="feature2Title">Inversi√≥n Inteligente</h3>
                        <p id="feature2Desc">Planifica tus aportaciones y maximiza el retorno de tu inversi√≥n</p>
                    </div>
                    <div class="feature-item">
                        <img src="public/tablero-de-dardos.png" alt="Objetivos" class="feature-icon">
                        <h3 id="feature3Title">Objetivos Claros</h3>
                        <p id="feature3Desc">Visualiza tus metas financieras y el camino para alcanzarlas</p>
                    </div>
                </div>
            </div>
        </section>

        <div class="content-wrapper" id="calculator">

        <div class="main-content">
            <!-- Formulario de entrada -->
            <div class="card">
                <h2 id="formTitle">Datos de Inversi√≥n</h2>
                
                <div class="input-group">
                    <label for="principal" id="labelPrincipal">Capital Inicial (‚Ç¨)</label>
                    <input type="number" id="principal" value="10000" min="0" step="100">
                </div>

                <div class="input-group">
                    <label for="contribution" id="labelContribution">Aportaci√≥n Mensual (‚Ç¨)</label>
                    <input type="number" id="contribution" value="200" min="0" step="50">
                </div>

                <div class="input-group">
                    <label for="rate" id="labelRate">Tasa de Inter√©s Anual (%)</label>
                    <input type="number" id="rate" value="7" min="0" max="100" step="0.1">
                </div>

                <div class="input-group">
                    <label for="years" id="labelYears">Per√≠odo (a√±os)</label>
                    <input type="number" id="years" value="10" min="1" max="50" step="1">
                </div>

                <div class="input-group">
                    <label for="frequency" id="labelFrequency">Frecuencia de Capitalizaci√≥n</label>
                    <select id="frequency">
                        <option value="12" id="optMonthly">Mensual</option>
                        <option value="4" id="optQuarterly">Trimestral</option>
                        <option value="2" id="optSemiannual">Semestral</option>
                        <option value="1" id="optAnnual">Anual</option>
                    </select>
                </div>

                <button class="calculate-btn" onclick="calculate()" id="btnCalculate">Calcular</button>
                <button class="reset-btn" onclick="resetForm()" id="btnReset">Reiniciar C√°lculo</button>
                <button class="download-btn" onclick="downloadPDF()" id="btnDownload">‚¨á Descargar Informe PDF</button>
            </div>

            <!-- Resultados -->
            <div class="card">
                <h2 id="resultsTitle">Resultados</h2>
                
                <div class="results" id="results">
                    <div class="result-item highlight">
                        <div class="label" id="labelFinalValue">Valor Final</div>
                        <div class="value" id="finalValue">‚Ç¨0.00</div>
                    </div>

                    <div class="result-item">
                        <div class="label" id="labelTotalInvested">Total Invertido</div>
                        <div class="value" id="totalInvested">‚Ç¨0.00</div>
                    </div>

                    <div class="result-item">
                        <div class="label" id="labelTotalInterest">Intereses Generados</div>
                        <div class="value" id="totalInterest">‚Ç¨0.00</div>
                    </div>

                    <div class="result-item">
                        <div class="label" id="labelReturnRate">Rentabilidad</div>
                        <div class="value" id="returnRate">0%</div>
                    </div>
                </div>

                <div class="chart-container" id="chartContainer">
                    <!-- El gr√°fico se generar√° din√°micamente -->
                </div>
                <div class="chart-legend">
                    <div class="legend-item">
                        <div class="legend-color invested"></div>
                        <span id="legendInvested">Total Invertido</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color gains"></div>
                        <span id="legendGains">Ganancias</span>
                    </div>
                </div>
            </div>

        </div>

        <!-- Tabla A√±o a A√±o -->
        <div class="yearly-table-section">
            <h3 id="tableTitle">üìã Evoluci√≥n A√±o a A√±o</h3>
            <div class="table-wrapper">
                <table id="yearlyTable">
                    <thead>
                        <tr>
                            <th id="thYear">A√±o</th>
                            <th id="thInvested">Total Invertido</th>
                            <th id="thYearInterest">Intereses del A√±o</th>
                            <th id="thTotalInterest">Intereses Acumulados</th>
                            <th id="thBalance">Capital Total</th>
                        </tr>
                    </thead>
                    <tbody id="yearlyTableBody">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Informaci√≥n adicional -->
        <div class="info-section">
            <h3 id="infoTitle">¬øQu√© es el Inter√©s Compuesto?</h3>
            <p id="infoPara1">
                El inter√©s compuesto es el inter√©s calculado sobre el capital inicial m√°s los intereses acumulados 
                de per√≠odos anteriores. Albert Einstein lo llam√≥ "la octava maravilla del mundo".
            </p>
            <p id="infoPara2">
                Con nuestra calculadora de Novusance Finance, puedes visualizar c√≥mo crecen tus inversiones a lo largo 
                del tiempo, considerando aportaciones peri√≥dicas y diferentes frecuencias de capitalizaci√≥n.
            </p>
            <p id="infoPara3">
                <strong>Consejo:</strong> Cuanto antes comiences a invertir y m√°s constante seas con tus aportaciones, 
                mayor ser√° el efecto del inter√©s compuesto en tu patrimonio.
            </p>
        </div>

        </div>

        <footer>
            <div class="footer-content">
                <div class="footer-disclaimer">
                    <h4 id="footerDisclaimerTitle">‚ö†Ô∏è Aviso Importante</h4>
                    <p id="footerDisclaimerText">
                        Los resultados proporcionados por esta calculadora son meramente orientativos y no constituyen 
                        asesoramiento financiero, fiscal ni de inversi√≥n. Novusance Finance no se responsabiliza 
                        de las decisiones tomadas bas√°ndose en los datos aqu√≠ mostrados. Consulta siempre con un 
                        asesor financiero cualificado antes de tomar decisiones de inversi√≥n.
                    </p>
                </div>
                <div class="footer-legal">
                    <h4 id="footerLegalTitle">‚öñÔ∏è Legal</h4>
                    <p id="footerLegalText">
                        Esta herramienta es de uso gratuito y se proporciona "tal cual", sin garant√≠as de ning√∫n tipo. 
                        Los tipos de inter√©s y resultados mostrados son hipot√©ticos y pueden no reflejar rentabilidades 
                        reales del mercado.<br><br>
                        <a onclick="openModal()">Aviso Legal completo ‚Üí</a>
                    </p>
                </div>
            </div>
            <div class="footer-bottom">
                <p id="footerText">&copy; 2024 Novusance Finance. Planifica tu futuro financiero con confianza.</p>
            </div>
        </footer>

        <!-- Modal Aviso Legal -->
        <div class="modal-overlay" id="legalModal">
            <div class="modal">
                <button class="modal-close" onclick="closeModal()">‚úï</button>
                <h3 id="modalTitle">Aviso Legal</h3>

                <h4 id="modalSection1Title">1. Titular del sitio web</h4>
                <p id="modalSection1Text">
                    Novusance Finance es un servicio digital de car√°cter informativo. 
                    Para cualquier consulta puedes contactarnos a trav√©s de la web.
                </p>

                <h4 id="modalSection2Title">2. Objeto y uso</h4>
                <p id="modalSection2Text">
                    Este sitio web ofrece una calculadora de inter√©s compuesto con fines exclusivamente 
                    educativos e informativos. No constituye en ning√∫n caso asesoramiento financiero, 
                    fiscal ni de inversi√≥n.
                </p>

                <h4 id="modalSection3Title">3. Exenci√≥n de responsabilidad</h4>
                <p id="modalSection3Text">
                    Novusance Finance no garantiza la exactitud, integridad o actualidad de los resultados 
                    generados. El usuario asume toda responsabilidad derivada del uso de esta herramienta. 
                    Las rentabilidades pasadas no garantizan rentabilidades futuras.
                </p>

                <h4 id="modalSection4Title">4. Propiedad intelectual</h4>
                <p id="modalSection4Text">
                    Todos los contenidos de este sitio web, incluyendo textos, dise√±o y c√≥digo, 
                    son propiedad de Novusance Finance y est√°n protegidos por las leyes de 
                    propiedad intelectual vigentes.
                </p>

                <h4 id="modalSection5Title">5. Ley aplicable</h4>
                <p id="modalSection5Text">
                    Este aviso legal se rige por la legislaci√≥n espa√±ola. Para cualquier controversia, 
                    las partes se someten a los juzgados y tribunales de Espa√±a.
                </p>
            </div>
        </div>
    </div>

    <script>
        // Traducciones
        const translations = {
            es: {
                headerSubtitle: "Planifica tu nueva era financiera",
                heroTitle: "Haz crecer tu <span class=\"highlight-text\">patrimonio</span> con el poder del inter√©s compuesto",
                heroDescription: "Descubre c√≥mo peque√±as inversiones hoy pueden transformarse en grandes ahorros ma√±ana. Con nuestra calculadora, visualiza el potencial de tus inversiones y toma el control de tu futuro financiero.",
                ctaButton: "Calcula tu inversi√≥n ahora",
                ctaComparator: "‚öñÔ∏è Comparar escenarios",
                feature1Title: "Crecimiento Exponencial",
                feature1Desc: "El inter√©s compuesto multiplica tu dinero de forma exponencial con el tiempo",
                feature2Title: "Inversi√≥n Inteligente",
                feature2Desc: "Planifica tus aportaciones y maximiza el retorno de tu inversi√≥n",
                feature3Title: "Objetivos Claros",
                feature3Desc: "Visualiza tus metas financieras y el camino para alcanzarlas",
                formTitle: "Datos de Inversi√≥n",
                labelPrincipal: "Capital Inicial (‚Ç¨)",
                labelContribution: "Aportaci√≥n Mensual (‚Ç¨)",
                labelRate: "Tasa de Inter√©s Anual (%)",
                labelYears: "Per√≠odo (a√±os)",
                labelFrequency: "Frecuencia de Capitalizaci√≥n",
                optMonthly: "Mensual",
                optQuarterly: "Trimestral",
                optSemiannual: "Semestral",
                optAnnual: "Anual",
                btnCalculate: "Calcular",
                btnReset: "Reiniciar C√°lculo",
                btnDownload: "‚¨á Descargar Informe PDF",
                resultsTitle: "Resultados",
                labelFinalValue: "Valor Final",
                labelTotalInvested: "Total Invertido",
                labelTotalInterest: "Intereses Generados",
                labelReturnRate: "Rentabilidad",
                infoTitle: "¬øQu√© es el Inter√©s Compuesto?",
                infoPara1: "El inter√©s compuesto es el inter√©s calculado sobre el capital inicial m√°s los intereses acumulados de per√≠odos anteriores. Albert Einstein lo llam√≥ \"la octava maravilla del mundo\".",
                infoPara2: "Con nuestra calculadora de Novusance Finance, puedes visualizar c√≥mo crecen tus inversiones a lo largo del tiempo, considerando aportaciones peri√≥dicas y diferentes frecuencias de capitalizaci√≥n.",
                infoPara3: "<strong>Consejo:</strong> Cuanto antes comiences a invertir y m√°s constante seas con tus aportaciones, mayor ser√° el efecto del inter√©s compuesto en tu patrimonio.",
                footerText: "&copy; 2024 Novusance Finance. Planifica tu futuro financiero con confianza.",
                yearLabel: "A√±o",
                legendInvested: "Total Invertido",
                legendGains: "Ganancias",
                tableTitle: "üìã Evoluci√≥n A√±o a A√±o",
                thYear: "A√±o",
                thInvested: "Total Invertido",
                thYearInterest: "Intereses del A√±o",
                thTotalInterest: "Intereses Acumulados",
                thBalance: "Capital Total",
                tableFooterYear: "TOTAL",
                footerDisclaimerTitle: "‚ö†Ô∏è Aviso Importante",
                footerDisclaimerText: "Los resultados proporcionados por esta calculadora son meramente orientativos y no constituyen asesoramiento financiero, fiscal ni de inversi√≥n. Novusance Finance no se responsabiliza de las decisiones tomadas bas√°ndose en los datos aqu√≠ mostrados. Consulta siempre con un asesor financiero cualificado antes de tomar decisiones de inversi√≥n.",
                footerLegalTitle: "‚öñÔ∏è Legal",
                footerLegalText: "Esta herramienta es de uso gratuito y se proporciona \"tal cual\", sin garant√≠as de ning√∫n tipo. Los tipos de inter√©s y resultados mostrados son hipot√©ticos y pueden no reflejar rentabilidades reales del mercado.<br><br><a onclick=\"openModal()\">Aviso Legal completo ‚Üí</a>",
                modalTitle: "Aviso Legal",
                modalSection1Title: "1. Titular del sitio web",
                modalSection1Text: "Novusance Finance es un servicio digital de car√°cter informativo. Para cualquier consulta puedes contactarnos a trav√©s de la web.",
                modalSection2Title: "2. Objeto y uso",
                modalSection2Text: "Este sitio web ofrece una calculadora de inter√©s compuesto con fines exclusivamente educativos e informativos. No constituye en ning√∫n caso asesoramiento financiero, fiscal ni de inversi√≥n.",
                modalSection3Title: "3. Exenci√≥n de responsabilidad",
                modalSection3Text: "Novusance Finance no garantiza la exactitud, integridad o actualidad de los resultados generados. El usuario asume toda responsabilidad derivada del uso de esta herramienta. Las rentabilidades pasadas no garantizan rentabilidades futuras.",
                modalSection4Title: "4. Propiedad intelectual",
                modalSection4Text: "Todos los contenidos de este sitio web, incluyendo textos, dise√±o y c√≥digo, son propiedad de Novusance Finance y est√°n protegidos por las leyes de propiedad intelectual vigentes.",
                modalSection5Title: "5. Ley aplicable",
                modalSection5Text: "Este aviso legal se rige por la legislaci√≥n espa√±ola. Para cualquier controversia, las partes se someten a los juzgados y tribunales de Espa√±a."
            },
            en: {
                headerSubtitle: "Plan your new financial era",
                heroTitle: "Grow your <span class=\"highlight-text\">wealth</span> with the power of compound interest",
                heroDescription: "Discover how small investments today can transform into significant savings tomorrow. With our calculator, visualize the potential of your investments and take control of your financial future.",
                ctaButton: "Calculate your investment now",
                ctaComparator: "‚öñÔ∏è Compare scenarios",
                feature1Title: "Exponential Growth",
                feature1Desc: "Compound interest multiplies your money exponentially over time",
                feature2Title: "Smart Investment",
                feature2Desc: "Plan your contributions and maximize your investment returns",
                feature3Title: "Clear Goals",
                feature3Desc: "Visualize your financial goals and the path to achieve them",
                formTitle: "Investment Data",
                labelPrincipal: "Initial Capital (‚Ç¨)",
                labelContribution: "Monthly Contribution (‚Ç¨)",
                labelRate: "Annual Interest Rate (%)",
                labelYears: "Period (years)",
                labelFrequency: "Compounding Frequency",
                optMonthly: "Monthly",
                optQuarterly: "Quarterly",
                optSemiannual: "Semi-annual",
                optAnnual: "Annual",
                btnCalculate: "Calculate",
                btnReset: "Reset Calculation",
                btnDownload: "‚¨á Download PDF Report",
                resultsTitle: "Results",
                labelFinalValue: "Final Value",
                labelTotalInvested: "Total Invested",
                labelTotalInterest: "Interest Generated",
                labelReturnRate: "Return Rate",
                infoTitle: "What is Compound Interest?",
                infoPara1: "Compound interest is interest calculated on the initial principal plus accumulated interest from previous periods. Albert Einstein called it \"the eighth wonder of the world\".",
                infoPara2: "With our Novusance Finance calculator, you can visualize how your investments grow over time, considering periodic contributions and different compounding frequencies.",
                infoPara3: "<strong>Tip:</strong> The sooner you start investing and the more consistent you are with your contributions, the greater the effect of compound interest on your wealth.",
                footerText: "&copy; 2024 Novusance Finance. Plan your financial future with confidence.",
                yearLabel: "Year",
                legendInvested: "Total Invested",
                legendGains: "Gains",
                tableTitle: "üìã Year-by-Year Breakdown",
                thYear: "Year",
                thInvested: "Total Invested",
                thYearInterest: "Year's Interest",
                thTotalInterest: "Cumulative Interest",
                thBalance: "Total Balance",
                tableFooterYear: "TOTAL",
                footerDisclaimerTitle: "‚ö†Ô∏è Important Notice",
                footerDisclaimerText: "The results provided by this calculator are for guidance purposes only and do not constitute financial, tax or investment advice. Novusance Finance is not responsible for decisions made based on the data shown here. Always consult a qualified financial advisor before making investment decisions.",
                footerLegalTitle: "‚öñÔ∏è Legal",
                footerLegalText: "This tool is free to use and is provided \"as is\", without warranties of any kind. Interest rates and results shown are hypothetical and may not reflect actual market returns.<br><br><a onclick=\"openModal()\">Full Legal Notice ‚Üí</a>",
                modalTitle: "Legal Notice",
                modalSection1Title: "1. Website owner",
                modalSection1Text: "Novusance Finance is an informational digital service. For any enquiries you can contact us through the website.",
                modalSection2Title: "2. Purpose and use",
                modalSection2Text: "This website offers a compound interest calculator for exclusively educational and informational purposes. It does not constitute financial, tax or investment advice under any circumstances.",
                modalSection3Title: "3. Disclaimer",
                modalSection3Text: "Novusance Finance does not guarantee the accuracy, completeness or timeliness of the results generated. The user assumes all responsibility arising from the use of this tool. Past returns do not guarantee future returns.",
                modalSection4Title: "4. Intellectual property",
                modalSection4Text: "All contents of this website, including texts, design and code, are the property of Novusance Finance and are protected by applicable intellectual property laws.",
                modalSection5Title: "5. Applicable law",
                modalSection5Text: "This legal notice is governed by Spanish law. For any disputes, the parties submit to the courts and tribunals of Spain."
            }
        };

        let currentLanguage = 'es';

        function changeLanguage(lang) {
            currentLanguage = lang;
            
            // Update button states
            document.getElementById('btnEs').classList.toggle('active', lang === 'es');
            document.getElementById('btnEn').classList.toggle('active', lang === 'en');
            
            // Update all text elements
            const trans = translations[lang];
            for (let key in trans) {
                const element = document.getElementById(key);
                if (element) {
                    element.innerHTML = trans[key];
                }
            }
            
            // Recalculate to update chart labels
            calculate();
        }

        function openModal() {
            document.getElementById('legalModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            document.getElementById('legalModal').classList.remove('active');
            document.body.style.overflow = '';
        }

        // Cerrar modal al hacer clic fuera
        document.getElementById('legalModal').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });

        function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'mm', 'a4');
            const isEN = currentLanguage === 'en';
            const pageW = 210;
            const margin = 20;
            const contentW = pageW - margin * 2;

            // ‚îÄ‚îÄ Colores de marca ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            const teal   = [26, 188, 156];
            const dark   = [44, 62, 80];
            const gray   = [120, 130, 140];
            const light  = [245, 250, 249];

            // ‚îÄ‚îÄ CABECERA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            doc.setFillColor(...teal);
            doc.rect(0, 0, pageW, 28, 'F');

            doc.setTextColor(255, 255, 255);
            doc.setFontSize(20);
            doc.setFont('helvetica', 'bold');
            doc.text('Novusance Finance', margin, 17);

            doc.setFontSize(9);
            doc.setFont('helvetica', 'normal');
            const subtitle = isEN ? 'Compound Interest Investment Report' : 'Informe de Inversi√≥n ‚Äî Inter√©s Compuesto';
            doc.text(subtitle, margin, 24);

            // Fecha arriba derecha
            const today = new Date().toLocaleDateString(isEN ? 'en-GB' : 'es-ES');
            doc.text(today, pageW - margin, 24, { align: 'right' });

            // ‚îÄ‚îÄ SECCI√ìN 1: PAR√ÅMETROS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            let y = 40;
            doc.setTextColor(...dark);
            doc.setFontSize(13);
            doc.setFont('helvetica', 'bold');
            doc.text(isEN ? 'Investment Parameters' : 'Par√°metros de Inversi√≥n', margin, y);

            // L√≠nea decorativa
            doc.setDrawColor(...teal);
            doc.setLineWidth(0.8);
            doc.line(margin, y + 2, margin + contentW, y + 2);
            y += 10;

            const principal     = parseFloat(document.getElementById('principal').value) || 0;
            const contribution  = parseFloat(document.getElementById('contribution').value) || 0;
            const rate          = parseFloat(document.getElementById('rate').value) || 0;
            const years         = parseInt(document.getElementById('years').value) || 0;
            const freqVal       = parseInt(document.getElementById('frequency').value) || 12;
            const freqLabel     = { 12: isEN ? 'Monthly' : 'Mensual', 4: isEN ? 'Quarterly' : 'Trimestral', 2: isEN ? 'Semi-annual' : 'Semestral', 1: isEN ? 'Annual' : 'Anual' }[freqVal];

            const params = [
                [isEN ? 'Initial Capital'        : 'Capital Inicial',         formatCurrency(principal)],
                [isEN ? 'Monthly Contribution'   : 'Aportaci√≥n Mensual',      formatCurrency(contribution)],
                [isEN ? 'Annual Interest Rate'   : 'Tasa de Inter√©s Anual',   rate.toFixed(2) + '%'],
                [isEN ? 'Investment Period'       : 'Per√≠odo de Inversi√≥n',    years + (isEN ? ' years' : ' a√±os')],
                [isEN ? 'Compounding Frequency'  : 'Capitalizaci√≥n',          freqLabel],
            ];

            // Fondo suave para la tabla de par√°metros
            params.forEach(([label, value], i) => {
                if (i % 2 === 0) {
                    doc.setFillColor(...light);
                    doc.rect(margin, y - 5, contentW, 9, 'F');
                }
                doc.setFontSize(10);
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(...gray);
                doc.text(label, margin + 3, y);
                doc.setFont('helvetica', 'normal');
                doc.setTextColor(...dark);
                doc.text(value, pageW - margin - 3, y, { align: 'right' });
                y += 10;
            });

            // ‚îÄ‚îÄ SECCI√ìN 2: RESULTADOS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            y += 6;
            doc.setTextColor(...dark);
            doc.setFontSize(13);
            doc.setFont('helvetica', 'bold');
            doc.text(isEN ? 'Results Summary' : 'Resumen de Resultados', margin, y);
            doc.setDrawColor(...teal);
            doc.line(margin, y + 2, margin + contentW, y + 2);
            y += 10;

            const finalValue    = document.getElementById('finalValue').textContent;
            const totalInvested = document.getElementById('totalInvested').textContent;
            const totalInterest = document.getElementById('totalInterest').textContent;
            const returnRate    = document.getElementById('returnRate').textContent;

            // Tarjeta destacada ‚Äî Valor Final
            doc.setFillColor(...teal);
            doc.roundedRect(margin, y, contentW, 18, 3, 3, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(10);
            doc.setFont('helvetica', 'normal');
            doc.text(isEN ? 'Final Value' : 'Valor Final', margin + 6, y + 7);
            doc.setFontSize(16);
            doc.setFont('helvetica', 'bold');
            doc.text(finalValue, pageW - margin - 6, y + 12, { align: 'right' });
            y += 24;

            // Las otras 3 m√©tricas en fila
            const metrics = [
                [isEN ? 'Total Invested'    : 'Total Invertido',    totalInvested],
                [isEN ? 'Interest Earned'   : 'Intereses Generados', totalInterest],
                [isEN ? 'Return Rate'       : 'Rentabilidad',        returnRate],
            ];
            const colW = contentW / 3 - 3;
            metrics.forEach(([label, value], i) => {
                const cx = margin + i * (colW + 4.5);
                doc.setFillColor(...light);
                doc.roundedRect(cx, y, colW, 18, 2, 2, 'F');
                doc.setDrawColor(...teal);
                doc.setLineWidth(0.4);
                doc.roundedRect(cx, y, colW, 18, 2, 2, 'S');
                doc.setTextColor(...gray);
                doc.setFontSize(8);
                doc.setFont('helvetica', 'normal');
                doc.text(label, cx + colW / 2, y + 6, { align: 'center' });
                doc.setTextColor(...dark);
                doc.setFontSize(11);
                doc.setFont('helvetica', 'bold');
                doc.text(value, cx + colW / 2, y + 13, { align: 'center' });
            });
            y += 26;

            // ‚îÄ‚îÄ SECCI√ìN 3: GR√ÅFICO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            y += 4;
            doc.setTextColor(...dark);
            doc.setFontSize(13);
            doc.setFont('helvetica', 'bold');
            doc.text(isEN ? 'Growth Chart' : 'Gr√°fico de Crecimiento', margin, y);
            doc.setDrawColor(...teal);
            doc.line(margin, y + 2, margin + contentW, y + 2);
            y += 10;

            // Obtener los datos calculados
            const chartBars = document.querySelectorAll('.bar-group');
            if (chartBars.length > 0) {
                const chartH  = 55;
                const barArea = contentW;
                const n       = chartBars.length;
                const barW    = Math.min((barArea / n) - 3, 14);
                const gap     = (barArea - barW * n) / (n + 1);

                // Recolectar datos del chart
                const chartData = [];
                chartBars.forEach(group => {
                    const label    = group.querySelector('.bar-group-label')?.textContent || '';
                    const stack    = group.querySelector('.bar-stack');
                    const gainBar  = stack?.querySelector('.bar.gains');
                    const invBar   = stack?.querySelector('.bar.invested');
                    const totalH   = parseFloat(stack?.style.height) || 0;
                    const gainH    = parseFloat(gainBar?.style.height) || 0;
                    const invH     = parseFloat(invBar?.style.height) || 0;
                    chartData.push({ label, totalH, gainH, invH });
                });

                const maxH = Math.max(...chartData.map(d => d.totalH));

                chartData.forEach((d, i) => {
                    const x        = margin + gap + i * (barW + gap);
                    const scaledT  = maxH > 0 ? (d.totalH / maxH) * chartH : 0;
                    const scaledI  = maxH > 0 ? (d.invH   / maxH) * chartH : 0;
                    const scaledG  = scaledT - scaledI;
                    const baseY    = y + chartH;

                    // Barra invertido (gris)
                    doc.setFillColor(189, 195, 199);
                    doc.rect(x, baseY - scaledI, barW, scaledI, 'F');

                    // Barra ganancias (turquesa)
                    doc.setFillColor(...teal);
                    doc.rect(x, baseY - scaledT, barW, scaledG, 'F');

                    // Etiqueta a√±o
                    doc.setTextColor(...gray);
                    doc.setFontSize(6.5);
                    doc.setFont('helvetica', 'normal');
                    doc.text(d.label, x + barW / 2, baseY + 5, { align: 'center' });
                });

                // L√≠nea base
                doc.setDrawColor(...gray);
                doc.setLineWidth(0.3);
                doc.line(margin, y + chartH, margin + contentW, y + chartH);
                y += chartH + 12;

                // Leyenda
                doc.setFillColor(...teal);
                doc.rect(margin, y, 8, 4, 'F');
                doc.setTextColor(...dark);
                doc.setFontSize(8);
                doc.text(isEN ? 'Gains' : 'Ganancias', margin + 10, y + 3.5);

                doc.setFillColor(189, 195, 199);
                doc.rect(margin + 45, y, 8, 4, 'F');
                doc.text(isEN ? 'Total Invested' : 'Total Invertido', margin + 55, y + 3.5);
                y += 12;
            }

            // ‚îÄ‚îÄ PIE DE P√ÅGINA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            doc.setFillColor(...teal);
            doc.rect(0, 287, pageW, 10, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(7);
            doc.setFont('helvetica', 'normal');
            const disclaimer = isEN
                ? 'Results are indicative only and do not constitute financial advice. Novusance Finance.'
                : 'Resultados orientativos. No constituyen asesoramiento financiero. Novusance Finance.';
            doc.text(disclaimer, pageW / 2, 293, { align: 'center' });

            // ‚îÄ‚îÄ SECCI√ìN 4: TABLA A√ëO A A√ëO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            doc.addPage();
            
            // Cabecera de la segunda p√°gina
            doc.setFillColor(...teal);
            doc.rect(0, 0, pageW, 20, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(13);
            doc.setFont('helvetica', 'bold');
            doc.text(isEN ? 'Year-by-Year Breakdown' : 'Evoluci√≥n A√±o a A√±o', margin, 13);
            doc.setFontSize(8);
            doc.setFont('helvetica', 'normal');
            doc.text('Novusance Finance', pageW - margin, 13, { align: 'right' });

            // Recoger datos de la tabla
            const rows = document.querySelectorAll('#yearlyTableBody tr');
            const tableData = [];
            rows.forEach((row, i) => {
                const cells = row.querySelectorAll('td');
                if (cells.length > 0 && i < rows.length - 1) { // excluir fila TOTAL
                    tableData.push([
                        cells[0].textContent,
                        cells[1].textContent,
                        cells[2].textContent,
                        cells[3].textContent,
                        cells[4].textContent
                    ]);
                }
            });

            // Fila de totales
            const lastRow = rows[rows.length - 1];
            const totalCells = lastRow?.querySelectorAll('td');
            const totalsRow = totalCells ? [
                totalCells[0].textContent,
                totalCells[1].textContent,
                totalCells[2].textContent,
                totalCells[3].textContent,
                totalCells[4].textContent
            ] : [];

            doc.autoTable({
                startY: 28,
                head: [[
                    isEN ? 'Year'             : 'A√±o',
                    isEN ? 'Total Invested'   : 'Total Invertido',
                    isEN ? "Year's Interest"  : 'Intereses del A√±o',
                    isEN ? 'Cumulative Int.'  : 'Intereses Acum.',
                    isEN ? 'Total Balance'    : 'Capital Total'
                ]],
                body: tableData,
                foot: [totalsRow],
                styles: {
                    fontSize: 9,
                    cellPadding: 4,
                    halign: 'right',
                },
                columnStyles: {
                    0: { halign: 'center', fontStyle: 'bold', textColor: teal }
                },
                headStyles: {
                    fillColor: teal,
                    textColor: [255, 255, 255],
                    fontStyle: 'bold',
                    halign: 'right',
                },
                footStyles: {
                    fillColor: [240, 253, 250],
                    textColor: dark,
                    fontStyle: 'bold',
                    halign: 'right',
                },
                alternateRowStyles: {
                    fillColor: light
                },
                margin: { left: margin, right: margin },
                theme: 'plain',
            });

            // Pie de p√°gina segunda hoja
            doc.setFillColor(...teal);
            doc.rect(0, 287, pageW, 10, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(7);
            doc.setFont('helvetica', 'normal');
            doc.text(disclaimer, pageW / 2, 293, { align: 'center' });

            // ‚îÄ‚îÄ DESCARGAR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            const filename = `Novusance_Informe_${years}${isEN ? 'yr' : 'a'}_${rate}pct.pdf`;
            doc.save(filename);
        }

        function generateYearlyTable(principal, monthlyContribution, annualRate, years, frequency) {
            const tbody = document.getElementById('yearlyTableBody');
            tbody.innerHTML = '';

            const ratePerPeriod = annualRate / frequency;
            const contributionPerPeriod = monthlyContribution * (12 / frequency);

            let balance = principal;
            let totalInvested = principal;
            let totalInterest = 0;

            for (let year = 1; year <= years; year++) {
                const balanceStartOfYear = balance;

                // Simular todos los per√≠odos de este a√±o
                for (let p = 0; p < frequency; p++) {
                    balance = balance * (1 + ratePerPeriod);
                    balance += contributionPerPeriod;
                    totalInvested += contributionPerPeriod;
                }

                const yearInterest = balance - balanceStartOfYear - (contributionPerPeriod * frequency);
                totalInterest += yearInterest;

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${year}</td>
                    <td>${formatCurrency(totalInvested)}</td>
                    <td class="gains-cell gains-positive">${formatCurrency(yearInterest)}</td>
                    <td class="gains-cell">${formatCurrency(totalInterest)}</td>
                    <td><strong>${formatCurrency(balance)}</strong></td>
                `;
                tbody.appendChild(tr);
            }

            // Fila de totales
            const totalRow = document.createElement('tr');
            const t = translations[currentLanguage];
            totalRow.innerHTML = `
                <td>${t.tableFooterYear}</td>
                <td>${formatCurrency(totalInvested)}</td>
                <td class="gains-cell">${formatCurrency(totalInterest)}</td>
                <td class="gains-cell">${formatCurrency(totalInterest)}</td>
                <td><strong>${formatCurrency(balance)}</strong></td>
            `;
            tbody.appendChild(totalRow);
        }

        function calculate() {
            // Obtener valores del formulario
            const principal = parseFloat(document.getElementById('principal').value) || 0;
            const monthlyContribution = parseFloat(document.getElementById('contribution').value) || 0;
            const annualRate = parseFloat(document.getElementById('rate').value) / 100 || 0;
            const years = parseInt(document.getElementById('years').value) || 0;
            const frequency = parseInt(document.getElementById('frequency').value) || 12;

            // Calcular el n√∫mero total de per√≠odos
            const totalPeriods = years * frequency;
            const ratePerPeriod = annualRate / frequency;

            // Calcular aportaci√≥n por per√≠odo
            const contributionPerPeriod = monthlyContribution * (12 / frequency);

            let balance = principal;
            let totalInvested = principal;
            const yearlyData = [];

            // Simular el crecimiento per√≠odo por per√≠odo
            for (let i = 1; i <= totalPeriods; i++) {
                // Agregar intereses
                balance = balance * (1 + ratePerPeriod);
                
                // Agregar aportaci√≥n
                balance += contributionPerPeriod;
                totalInvested += contributionPerPeriod;

                // Guardar datos anuales para el gr√°fico
                if (i % frequency === 0) {
                    const gains = balance - totalInvested;
                    yearlyData.push({
                        year: i / frequency,
                        value: balance,
                        invested: totalInvested,
                        gains: gains
                    });
                }
            }

            const finalValue = balance;
            const totalInterest = finalValue - totalInvested;
            const returnRate = ((finalValue - totalInvested) / totalInvested * 100);

            // Mostrar resultados
            document.getElementById('finalValue').textContent = formatCurrency(finalValue);
            document.getElementById('totalInvested').textContent = formatCurrency(totalInvested);
            document.getElementById('totalInterest').textContent = formatCurrency(totalInterest);
            document.getElementById('returnRate').textContent = returnRate.toFixed(2) + '%';

            // Generar gr√°fico
            generateChart(yearlyData);

            // Generar tabla a√±o a a√±o
            generateYearlyTable(principal, monthlyContribution, annualRate, years, frequency);
        }

        function resetForm() {
            // Restablecer valores por defecto
            document.getElementById('principal').value = 10000;
            document.getElementById('contribution').value = 200;
            document.getElementById('rate').value = 7;
            document.getElementById('years').value = 10;
            document.getElementById('frequency').value = 12;
            
            // Recalcular con valores por defecto
            calculate();
        }

        function formatCurrency(amount) {
            return '‚Ç¨' + amount.toLocaleString('es-ES', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }

        function generateChart(data) {
            const container = document.getElementById('chartContainer');
            container.innerHTML = '';

            if (data.length === 0) return;

            const maxValue = Math.max(...data.map(d => d.value));
            const maxBars = 10;
            const step = Math.ceil(data.length / maxBars);
            const displayData = data.filter((_, index) => index % step === 0 || index === data.length - 1);

            const yearLabel = translations[currentLanguage].yearLabel;
            const maxHeight = 280;

            displayData.forEach(item => {
                const barGroup = document.createElement('div');
                barGroup.className = 'bar-group';

                // Calcular alturas proporcionales
                const totalHeight = (item.value / maxValue) * maxHeight;
                const investedHeight = (item.invested / maxValue) * maxHeight;
                const gainsHeight = totalHeight - investedHeight;

                // Contenedor de barra apilada
                const barStack = document.createElement('div');
                barStack.className = 'bar-stack';
                barStack.style.height = totalHeight + 'px';

                // Barra de ganancias (encima)
                const gainsBar = document.createElement('div');
                gainsBar.className = 'bar gains';
                gainsBar.style.height = gainsHeight + 'px';
                gainsBar.title = `${yearLabel} ${item.year} ‚Äî ${translations[currentLanguage].legendGains}: ${formatCurrency(item.gains)}`;

                // Barra de invertido (debajo)
                const investedBar = document.createElement('div');
                investedBar.className = 'bar invested';
                investedBar.style.height = investedHeight + 'px';
                investedBar.title = `${yearLabel} ${item.year} ‚Äî ${translations[currentLanguage].legendInvested}: ${formatCurrency(item.invested)}`;

                barStack.appendChild(gainsBar);
                barStack.appendChild(investedBar);

                // Etiqueta del a√±o
                const label = document.createElement('div');
                label.className = 'bar-group-label';
                label.textContent = yearLabel + ' ' + item.year;

                barGroup.appendChild(barStack);
                barGroup.appendChild(label);
                container.appendChild(barGroup);
            });
        }

        // Calcular autom√°ticamente al cargar la p√°gina
        window.onload = function() {
            calculate();
        };

        // Recalcular cuando cambian los valores
        document.querySelectorAll('input, select').forEach(element => {
            element.addEventListener('input', calculate);
        });
    </script>
</body>
</html>